# 文件加密/解密工具

## 简介

这是一个功能强大的文件加密/解密工具，支持多种加密算法（AES-256、Blowfish、XOR），能够安全地加密和解密单个文件或整个目录。工具采用了先进的密码学安全措施，确保数据安全可靠。

## 主要特性

- ✅ 支持AES-256、Blowfish和XOR三种加密算法，满足不同安全级别需求
- ✅ 目录级加密/解密，支持递归处理子目录，一键加密整个文件夹
- ✅ 安全的密钥管理（PBKDF2密钥派生 + 随机盐值），防止彩虹表攻击
- ✅ 文件完整性验证（MD5校验），确保加密/解密过程数据一致性
- ✅ 原子性文件操作，确保数据安全，避免操作中断导致数据损坏
- ✅ 流式处理，支持大文件操作，内存占用低
- ✅ 跨平台支持（Windows、Linux、macOS、Android），一次编写到处运行
- ✅ 详细的日志记录和错误处理，便于问题排查和操作审计
- ✅ 内置帮助文档，使用 `-h` 或 `--help` 参数查看，易于上手
- ✅ Web管理界面，提供现代化图形化操作体验，支持响应式设计
- ✅ RESTful API接口，支持程序化调用，便于集成到其他系统
- ✅ 实时进度跟踪，准确显示操作进度，提升用户体验
- ✅ 文件映射表管理，支持加密文件信息查看和预览

## 快速开始

### 编译

```bash
chmod +x build.sh
./build.sh
```

编译完成后，将在 `dist` 目录下生成各平台的二进制文件：
- Linux: `encrypt-linux-amd64`
- Windows: `encrypt-windows-amd64.exe`
- macOS Intel: `encrypt-mac-amd64`
- macOS ARM: `encrypt-mac-arm64`
- Android: `encrypt-android-arm64`

### 查看帮助文档

```bash
./dist/encrypt-linux-amd64 -h
```

或者：

```bash
./dist/encrypt-linux-amd64 --help
```

### 启动Web管理界面

```bash
./dist/encrypt-linux-amd64 -webui
```

默认监听端口为 9394，可通过浏览器访问 http://localhost:9394

### 命令行模式

工具支持多种命令行操作模式：

1. **加密模式**：
```bash
./dist/encrypt-linux-amd64 -encrypt
```
执行加密操作，根据配置文件中的设置加密指定目录中的文件。

2. **解密模式**：
```bash
./dist/encrypt-linux-amd64 -decrypt
```
执行解密操作，根据配置文件中的设置解密指定目录中的文件。

3. **WebUI模式**：
```bash
./dist/encrypt-linux-amd64 -webui
```
启动Web管理界面，默认监听端口9394。

### 配置

首次运行时会自动生成 `encrypt_config.yaml` 配置文件：

```yaml
# 加密/解密密码（请务必修改为强密码）
password: "your_strong_password"

# 加密算法类型
# 可选值：aes, blowfish, xor
encrypt_type: aes

# 目标路径列表（支持多个目录或文件）
target_paths:
  - "/path/to/target/directory"

# 混淆文件名后缀
obfuscate_suffix: ".dat"

# 混淆文件名长度
obfuscate_name_length: 12

# 映射文件名（用于存储加密前后的文件映射关系）
map_filename: ".app_encrypt"

# 锁文件名（用于防止程序重复运行）
lock_filename: ".encrypt.lock"

# 映射文件存储路径（请确保有写权限）
map_storage_path: "/path/to/map/storage"

# 盐值（可选，用于密钥派生，留空则自动生成随机盐值）
salt: ""

# 是否显示详细日志
debug: false
```

### 加密文件/目录

```bash
./dist/encrypt-linux-amd64 -encrypt
```

### 解密文件/目录

```bash
./dist/encrypt-linux-amd64 -decrypt
```

## Web管理界面

本工具提供现代化的Web管理界面，支持以下功能：

1. **系统状态监控**：实时显示应用运行状态、加密算法和目标路径数
2. **配置管理**：可视化配置文件编辑，支持密码明文查看功能
3. **操作控制**：一键启动加密/解密操作，支持停止操作
4. **进度跟踪**：实时显示操作进度条，进度条与实际执行日志和文件状态保持实时同步
5. **日志查看**：实时滚动显示操作日志，支持自动滚动和手动查看
6. **映射表查看**：查看已加密文件的映射关系，按配置路径分别显示各自路径的对象文件

### WebUI功能实现状态

#### 已完整实现的功能

1. **Web服务器基础架构**
   - 端口9394监听
   - 静态资源嵌入(embed.FS)
   - 响应式设计，支持移动端

2. **仪表板页面**
   - 系统状态监控(应用状态、加密算法、目标路径数)
   - 操作控制(开始加密、开始解密、停止操作)
   - 实时进度条显示(已实现真实进度跟踪)
   - 实时日志流显示(Server-Sent Events)

3. **配置管理页面**
   - 可视化配置文件编辑
   - 密码明文查看功能
   - 配置加载和保存

4. **映射表页面**
   - 加密文件列表显示
   - 按配置路径分组显示
   - 刷新功能

5. **API接口**
   - `/api/config` - 配置管理
   - `/api/files` - 文件列表
   - `/api/start` - 启动加密/解密
   - `/api/stop` - 停止操作
   - `/api/status` - 系统状态
   - `/api/logs` - 实时日志流
   - `/api/progress` - 进度跟踪

6. **技术特性**
   - 实时进度条(准确反映处理进度)
   - Server-Sent Events实现实时日志
   - 响应式设计，支持手机、平板等设备
   - 现代化UI界面
   - 单二进制文件打包(embed静态资源)

#### 已有接口但未完全实现的功能

1. **文件预览功能**
   - 后端已实现API接口:
     - `/api/preview` - 文件预览
     - `/api/decrypt-preview` - 解密预览
   - 前端暂未实现相关调用和界面集成
   - 功能描述: 支持使用配置文件中的密码和盐值临时解密查看文件内容
### WebUI特性

- 响应式设计，支持桌面、平板和手机设备
- 使用现代化UI设计，界面美观专业
- 实时日志流，通过Server-Sent Events技术实现
- 密码输入框支持明文查看功能（点击眼睛图标切换）
- 现代化的UI设计，提供良好的用户体验
- 支持实时进度跟踪，进度条百分比准确反映实际操作进度
- 文件预览功能支持使用配置文件中的密码和盐值临时解密查看文件内容

### WebUI操作指南

1. **配置管理**：
   - 在配置管理页面可以设置加密密码、选择加密算法、指定目标路径等
   - 支持保存和加载配置文件
   - 密码输入框具有明文查看功能，点击眼睛图标可切换显示/隐藏密码

2. **加密/解密操作**：
   - 点击"开始加密"或"开始解密"按钮启动相应操作
   - 操作过程中会显示实时进度条，准确反映当前处理进度
   - 可以通过"停止操作"按钮中断正在进行的操作

3. **状态监控**：
   - 实时显示操作日志，支持自动滚动到底部
   - 可以查看已加密文件的映射表信息
   - 支持查看加密文件的详细信息，包括文件大小、类型等

4. **文件预览**：
   - 可以在不解密原始文件的情况下，使用配置文件中的密码和盐值临时解密查看文件内容
   - 支持查看图片、文本等常见文件类型的预览
   - 预览功能不会影响存储在配置文件路径中的加密文件

## 命令行参数详解

工具支持以下命令行参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| `-h`, `--help` | 显示帮助信息 | `./encrypt -h` |
| `-encrypt` | 执行加密操作 | `./encrypt -encrypt` |
| `-decrypt` | 执行解密操作 | `./encrypt -decrypt` |
| `-webui` | 启动Web管理界面 | `./encrypt -webui` |

### 使用示例

1. **查看帮助信息**：
```bash
./encrypt -h
```
显示详细的使用说明和配置参数说明。

2. **执行加密操作**：
```bash
./encrypt -encrypt
```
根据配置文件中的设置加密指定目录中的文件。

3. **执行解密操作**：
```bash
./encrypt -decrypt
```
根据配置文件中的设置解密指定目录中的文件。

4. **启动Web管理界面**：
```bash
./encrypt -webui
```
启动Web管理界面，默认监听端口9394。

### 命令行模式说明

工具支持三种主要操作模式：

1. **加密模式** (`-encrypt`)：
   - 根据配置文件中的设置加密指定目录中的文件
   - 加密后的文件会被混淆命名并保存映射关系
   - 支持目录递归处理
   - 自动生成映射文件用于后续解密

2. **解密模式** (`-decrypt`)：
   - 根据配置文件中的设置解密指定目录中的文件
   - 需要使用与加密时完全一致的密码和加密算法
   - 自动删除映射文件完成解密
   - 支持目录递归处理

3. **WebUI模式** (`-webui`)：
   - 启动图形化Web管理界面
   - 提供可视化的配置管理和操作控制
   - 支持实时进度跟踪和日志查看

## RESTful API接口

Web管理界面通过以下RESTful API接口与后端通信：

### 基础信息接口

#### 获取系统状态
```
GET /api/status
响应: {"status": "running|stopped"}
```

#### 获取配置信息
```
GET /api/config
响应: 配置对象JSON
```

#### 保存配置信息
```
POST /api/config
请求体: 配置对象JSON
响应: {"status": "success"}
```

### 文件管理接口

#### 获取加密文件列表
```
GET /api/files
响应: {"files": [文件对象数组]}
```

#### 预览加密文件信息
```
GET /api/preview?path=文件路径
响应: 文件信息JSON
```

#### 解密预览文件内容
```
GET /api/decrypt-preview?path=文件路径
响应: 解密后的文件信息和内容（Base64编码）
```

### 操作控制接口

#### 启动加密/解密操作
```
POST /api/start?mode=encrypt|decrypt
响应: {"status": "started", "mode": "encrypt|decrypt"}
```

#### 停止操作
```
POST /api/stop
响应: {"status": "stopped"}
```

#### 实时日志流
```
GET /api/logs
响应: Server-Sent Events流，持续推送日志消息
```

## 加密算法详解

### 1. AES-256（推荐）

AES（Advanced Encryption Standard）是美国联邦政府采用的一种区块加密标准，也是目前应用最广泛的对称加密算法之一。

**技术细节：**
- 使用AES-256算法，密钥长度为256位
- 采用CBC（Cipher Block Chaining）模式进行加密
- 使用PBKDF2密钥派生函数，迭代次数10000次
- 自动生成随机盐值（16字节）和初始化向量(IV)（16字节）
- 使用PKCS#7填充方案
- 支持流式处理，适合大文件加密

**特点：**
- 安全性：最高（军事级别的加密标准）
- 性能：中等（比XOR慢，但比大多数加密算法快）
- 抵抗已知明文攻击和统计分析
- 经过广泛的安全性验证和实际应用检验

**适用场景：**
- 敏感个人数据加密
- 财务信息保护
- 商业机密和重要文件加密
- 需要长期保存的加密数据

### 2. Blowfish

Blowfish是一种对称密钥分组密码算法，由Bruce Schneier在1993年设计，旨在作为DES算法的替代品。

**技术细节：**
- 分组长度：64位
- 密钥长度：32位到448位（本工具使用256位）
- 轮数：16轮
- 使用Feistel网络结构
- 支持流式处理

**特点：**
- 安全性：较高（经过广泛验证的加密算法）
- 性能：较好（在大多数硬件上表现良好）
- 可变长度密钥设计（支持32位到448位密钥）
- 实现简单且稳定
- 安全性良好，适合一般用途

**适用场景：**
- 中等敏感数据加密
- 对性能有一定要求的应用
- 需要平衡安全性和速度的场合
- 嵌入式设备或资源受限环境

### 3. XOR

XOR（异或）是一种简单的位运算加密方法，通过对明文和密钥进行异或操作来实现加密和解密。

**技术细节：**
- 使用简单的逐字节异或操作
- 密钥长度可变，本工具使用256位密钥
- 不使用盐值或IV
- 不使用填充方案
- 处理速度快，内存占用少

**特点：**
- 安全性：较低（仅适合基本保护）
- 性能：最佳（最快的加密方式）
- 实现简单，计算开销最小
- 速度极快，适合处理大量文件
- 安全性相对较低，不建议用于敏感数据
- 相同明文和密钥会产生相同密文，容易受到统计分析攻击

**适用场景：**
- 大量非敏感数据的快速加密
- 对加密速度要求极高的场合
- 临时数据保护
- 作为多层加密的第一层处理

## 安全性说明

1. **密码强度**：请使用强密码，建议至少16位，包含大小写字母、数字和特殊字符
2. **备份重要数据**：加密前请确保备份原始文件
3. **妥善保管密码**：密码丢失将无法恢复加密文件
4. **权限控制**：限制配置文件的访问权限，避免密码泄露
5. **定期更换密码**：建议定期更换加密密码，提高安全性
6. **多层加密策略**：对于极高敏感性的数据，可考虑结合多种加密算法
7. **安全存储映射文件**：映射文件包含文件路径信息，应妥善保管，避免泄露文件结构
8. **使用HTTPS**：在生产环境中使用WebUI时，建议配置HTTPS以保护数据传输安全

## 依赖项

- Go 1.18+
- `golang.org/x/crypto/pbkdf2`
- `gopkg.in/yaml.v2`

## 安装依赖

```bash
go get -u golang.org/x/crypto/pbkdf2
go get -u gopkg.in/yaml.v2
```

## 详细文档

- **操作手册**：操作手册.md
- **Bug分析报告**：bug_analysis_report.md

## 版本历史

### v1.0.0
- 初始版本发布
- 支持AES-256、Blowfish和XOR三种加密算法
- 实现目录级加密/解密功能
- 提供Web管理界面
- 支持RESTful API接口

### v1.1.0
- 增强WebUI界面，提供更现代化的用户体验
- 实现实时进度跟踪功能，准确显示操作进度
- 支持文件映射表管理和预览功能
- 优化加密/解密性能
- 修复已知问题，提升稳定性

## 注意事项

1. 使用本工具加密文件后，请务必妥善保管配置文件和密码
2. 加密算法的选择会影响加密强度和性能：
   - AES-256：安全性最高，性能适中
   - Blowfish：安全性较高，性能较好
   - XOR：性能最佳，但安全性相对较低
3. 解密时请确保使用与加密时相同的密码和加密算法
4. 加密过程中请勿中断操作，可能导致数据损坏
5. 建议在加密大量文件前先进行小规模测试
6. 定期检查加密文件的完整性
7. 在使用WebUI时，注意不要在公共网络环境下暴露管理界面
8. 如需在多台设备间共享加密文件，请确保所有设备使用相同的配置和密码

## 免责声明

本工具仅供学习和合法用途。使用本工具加密重要数据前，请确保理解可能的风险，并进行充分的测试。作者不对因使用本工具导致的数据丢失或其他损失负责。